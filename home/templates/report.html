{% extends 'base_admin.html' %}

{% block title %}
Thống kê doanh thu
{% endblock title %}
{% block content %}
<style type="text/css">
    .form-signin {
        width: 100%;
        max-width: 330px;
        padding: 15px;
        margin: auto;
    }
    .form-signin .checkbox {
        font-weight: 400;
    }
    .form-signin .form-control {
        position: relative;
        box-sizing: border-box;
        height: auto;
        padding: 10px;
        font-size: 16px;
    }
    .form-signin .form-control:focus {
        z-index: 2;
    }
    .form-signin input[type="email"] {
        margin-bottom: 10px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
    }

    .h3{
        text-align: center;
    }
    </style>


    <form method="get">
		{% csrf_token %}
		<div class="row">
			<div class="col-sm-2"></div>
			<div class="col-sm-2"><label>Ngày Bắt Đầu</label></div>
			<div class="col-sm-4">
				<div class="form-group" >
					<div class="input-group date" data-provide="datepicker" >
						<input type="date" class="form-control" name="create_at__gte" id="id_create_at__gte">
						  
					</div>
				</div>
			</div>
			<div class="col-sm-2 mt-4">
				<button type="submit" class="btn btn-primary">Tìm Kiếm</button>
			</div>                                
		</div>
		<div class="row">
			<div class="col-sm-2"></div>
			<div class="col-sm-2">
				<label>Ngày Kết Thúc</label>
			</div>
			<div class="col-sm-4">
				<div class="input-group date" data-provide="datepicker" >
					<input type="date" class="form-control" name="create_at__lte" id="id_create_at__lte">
					
				</div>
			</div>
			<div class="col-sm-4">

			</div>    
			                            
		</div>
		<br>
		<div class="row">
			<div class="col-sm-2"></div>
			<div class="col-sm-2">
				<label>Trạng thái đơn hàng</label>
			</div>
			<div class="col-sm-4">
				<div class="form-group">                                        
				<select  class="custom-select" id="status"  name="status" onChange="urlDirect()">																			
						<option value="Mới">Mới</option>   
						<option value="Đã Xác Nhận">Đã Xác Nhận</option>
						<option value="Đang Vận Chuyển">Đang Vận Chuyển</option> 
						<option value="Hoàn Thành">Hoàn Thành</option> 
						<option value="Đã Hủy">Đã Hủy</option>                                         
				</select>
			</div>
			</div>
			<div class="col-sm-4">

			</div>    
			                            
		</div>
		
			
		
		
	</form>
       
	<table class="table table-striped table-condensed" id="countit">
		<thead>
			<tr>
				<th class="text-center" width="115px">STT</th>
				<th class="text-center" width="115px">Mã đơn</th>
				<th class="text-center" width="115px">Tổng tiền</th>
				<th class="text-center" width="115px">Ngày tạo</th>
				<th class="text-center" width="115px">Trạng thái</th>
				
			</tr>
		</thead>   
		<tbody> 
			{% for order in filter.qs %}             
			<tr>
				<td class="text-center">{{ forloop.counter}}</td>
				<td class="text-center">{{ order.code}}</td>
				<td style ="text-align:center" class="count-me">{{order.total}}</span></td>
				<td class="text-center">{{order.create_at|date:"d/m/Y H:i:s"}}</span></td>
				<td class="text-center">{{order.status}}</span></td>
				
			</tr>
			{% endfor %}
			{% comment %} <tr><td></td><td class="text-center" style="font-weight:bold;font-size:20pt; color:#E74C3C"for="Total">Tổng :</td><td class="text-center" style="font-weight:bold;font-size:15pt;color:#E74C3C" id="tong">VNĐ</td><td></td><td></td></tr> {% endcomment %}
			<h4><label style="color:#E74C3C" for="Total"></label><span id="totallabel"></span></h4>
			
		</tbody>
		<label id= "totallabel"></label>
	</table>
<script language="javascript" type="text/javascript">
	var tds = document.getElementById('countit').getElementByTagName('td');
	var sum = 0;
	for(var i = 0; i < tds.length; i++) {
		if(tds[i].className == 'count-me') {
			sum += isNaN(tds[i].innerHTML) ? 0 : parseInt(tds[i].innerHTML);
		}
	}
	document.getElementById('countit').innerHTML += '<tr><td></td><td class="text-center" style="font-weight:bold;font-size:20pt; color:#E74C3C">Tổng :</td><td class="text-center" style="font-weight:bold;font-size:15pt;color:#E74C3C" >' + sum + ' VNĐ</td><td></td><td></td></tr>';
</script>

		{% comment %} $(function(){
			var total = 0;
			$("[id*=totalprice]").each(function(){
				total = total + parseInt($(this).html());

			});
			$("[id*=totallabel]").html("Tổng = "+total.toString());
		}); {% endcomment %}
		{% comment %} var sum = 0;
        $('.totalprice').each(function(){
            sum += parseFloat($(this).text()); 
        });
        document.getElementById("tong").innerHTML = sum; {% endcomment %}
{% endblock %}